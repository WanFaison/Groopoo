<div class="container-fluid min-vh-100">
    <app-nav></app-nav>
    
    <div class="mt-5 row justify-content-center align-items-center h-100">
        <div class="flex-center my-3 flex-column">
            <div class="d-flex justify-content-between">
              <h4 *ngIf="groupResponse" class="underline-bold">{{groupResponse.results[0].listeT}}</h4>
              <a *ngIf="user?.role != 'ROLE_VISITEUR' && groupResponse && !listeResponse?.results?.isComplet"
              data-bs-toggle="modal" data-bs-target="#modifModal"
              class="nav-link mx-1 text-black"
              (click)="libelle = groupResponse.results[0].listeT;" ><i class="fas fa-lg fa-edit"></i></a>
            </div>
            <div class="d-flex justify-content-between mt-2">
              <div class="col-md-8">
                <button (click)="printXls('results')" class="btn btn-info col-md-4 mb-2 me-2">Exporter les Groupes</button>
                <button (click)="printXls()" class="btn btn-info mb-2 me-2">Liste d'Emargement</button>
                <button class="btn btn-secondary mb-2 me-2"
                [routerLink]="['/app/view-jours']" routerLinkActive="active"
                >Liste des Journées</button>
              </div>
              <div class="ml-4" *ngIf="user?.role != 'ROLE_VISITEUR'">
                <button (click)="useListe()" class="btn btn-secondary mb-2 me-2">Réutiliser la liste</button>
                <button class="btn btn-success mb-5"
                *ngIf="!listeResponse?.results?.isComplet"
                data-bs-toggle="modal" data-bs-target="#ynModal"
                >Reformer les groupes</button>
              </div>
            </div>
        </div>
        
        <div class="d-flex flex-column justify-content-center align-items-center">
            <table class="table col-md-2 mb-3">
              <thead class="thead-dark">
                <tr>
                  <th scope="col">Nombre de groupes:</th>
                  <th scope="col">{{ listeResponse?.results?.count }}</th>
                </tr>
              </thead>
            </table>
            <table *ngFor="let grp of groupResponse?.results; let i = index" class="table col-md-9 mb-5">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col">{{grp.libelle}}</th>
                        <th scope="col">{{'Note: ' + grp.note}}</th>
                    </tr>
                    <tr>
                        <th scope="col">Matricule</th>
                        <th scope="col">Noms</th>
                        <th scope="col">Sexe</th>
                        <th scope="col">Classe</th>
                        <th *ngIf="user?.role != 'ROLE_VISITEUR'" scope="col">Note Etudiant</th>
                        <th *ngIf="user?.role != 'ROLE_VISITEUR'" scope="col">Note Finale</th>
                        <th *ngIf="!listeResponse?.results?.isComplet">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let etd of grp.etudiants; let i = index">
                        <th scope="row">{{etd.matricule}}</th>
                        <td>{{etd.nom}} {{etd.prenom}}</td>
                        <td>{{etd.sexe}}</td>
                        <td>{{etd.classe}}</td> 
                        <td *ngIf="user?.role != 'ROLE_VISITEUR'">{{etd.noteEtd}}</td> 
                        <td *ngIf="user?.role != 'ROLE_VISITEUR'">{{etd.noteFinal}}</td> 
                        <td *ngIf="!listeResponse?.results?.isComplet">
                          <button class="btn btn-secondary"
                          (click)="findEtd(etd.id)"
                          data-bs-toggle="modal" data-bs-target="#transfererModal">Transferer</button>
                        </td>
                    </tr>
                </tbody>
              </table>
        </div>

        <div class="pagination-div" style="margin-bottom: 8rem;">
          <nav aria-label="Page navigation example">
            <ul class="pagination">
              <li *ngIf="groupResponse && groupResponse.currentPage !== undefined" class="page-item" [ngClass]="{'disabled': groupResponse.currentPage === 0}">
                <a class="page-link" (click)="paginate(groupResponse.currentPage - 1)" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                  <span class="sr-only">Previous</span>
                </a>
              </li>
              
              <li *ngIf="groupResponse && groupResponse.currentPage !== undefined" class="page-item" [ngClass]="{'disabled': groupResponse.currentPage +1 === groupResponse.totalPages}">
                <a class="page-link" (click)="paginate(groupResponse.currentPage + 1)" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                  <span class="sr-only">Next</span>
                </a>
              </li>
            </ul>
          </nav>
        </div>    
    </div>



    <!-- Modal -->
    <div class="modal fade" id="modifModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
      <div class="modal-content row">
          <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Modifier Liste</h5>
              <button (click)="libelle = ''; error = false;" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <label class="form-label custom-label" for="libelle">Libelle</label>
              <input required id="libelle" #libelleInput="ngModel" [(ngModel)]="libelle" 
              name="libelle" class="form-control form-control-lg custom-input" placeholder="Entrez le nom..." />
              <div *ngIf="libelleInput.invalid && libelleInput.touched" class="text-danger">
                  Le nom/libelle est requis.
              </div>
              <div *ngIf="error" class="text-danger">
                Une liste de ce nom existe déjà
              </div>
          </div>
          <div class="modal-footer d-flex">
              <button (click)="modifEnt(liste, libelle)" type="button" 
              class="btn btn-success">Modifier</button>
              <button (click)="libelle = ''; error = false;" type="button" class="btn btn-secondary" 
              data-bs-dismiss="modal">Close</button>
          </div>
      </div>
      </div>
    </div>

    <!-- Modal transferer-->
    <div class="modal fade" id="transfererModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
      <div class="modal-content row">
          <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">{{ 'Transferer ' + etdResponse2?.results?.nom + ' vers...' }}</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <label class="form-label custom-label" for="libelle">Choisir son nouveau groupe</label>
              <div class="input-group me-2">
                <select [(ngModel)]="grp" class="form-select" aria-label=".form-select-sm example">
                  <option selected value="0">groupe...</option>
                  <option *ngFor="let item of grpReq?.results" [value]="item.id">{{ item.libelle }}</option>
                </select>
              </div>
          </div>
          <div class="modal-footer d-flex">
              <button (click)="transferEtd(grp)" type="button" 
              class="btn btn-success">Confirmer</button>
              <button type="button" class="btn btn-secondary" 
              data-bs-dismiss="modal">Close</button>
          </div>
      </div>
      </div>
    </div>

    <!-- Modal yn-->
    <div class="modal fade" id="ynModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
      <div class="modal-content row">
          <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Refaire la liste</h5>
              <button type="button" class="btn-close"
              data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <h4 class="form-label custom-label">Voulez vous reformer cette liste?</h4>
              <p>NB: La réforme de cette liste mettrait en péril l'ordre des notes déjà enregistrées </p>
          </div>
          <div class="modal-footer d-flex">
              <button (click)="reDoList()" type="button" class="btn btn-success">Oui</button>
              <button type="button" class="btn btn-secondary" 
              data-bs-dismiss="modal">Non</button>
          </div>
      </div>
      </div>
    </div>


    <app-foot></app-foot>
</div>

